<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
	<meta charset='UTF-8'>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>core/PGbasicmacros.pl</title>
	<link rel="shortcut icon" href="/favicon.ico">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="https://openwebwork.github.io/pg-docs/pod/assets/podviewer.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" defer></script>
	<script src="https://openwebwork.github.io/pg-docs/pod/assets/podviewer.js" defer></script>
</head>
<body>
	<div class="pod-header navbar navbar-dark bg-primary px-3 position-fixed border-bottom border-dark">
		<div class="container-fluid d-flex flex-column d-md-block">
			<h1 class="navbar-brand fw-bold fs-5 me-auto me-md-0 mb-2 mb-md-0">core/PGbasicmacros.pl</h1>
			<button class="navbar-toggler d-md-none me-auto" type="button" data-bs-toggle="offcanvas"
				data-bs-target="#sidebar" aria-controls="sidebar" aria-label="Toggle Sidebar">
				<span class="navbar-toggler-icon"></span>
			</button>
		</div>
	</div>
	<aside class="offcanvas-md offcanvas-start border-end border-dark position-fixed" tabindex="-1"
		id="sidebar" aria-labelledby="sidebar-label">
		<div class="offcanvas-header">
			<h2 class="offcanvas-title" id="sidebar-label">Index</h2>
			<button type="button" class="btn-close" data-bs-dismiss="offcanvas" data-bs-target="#sidebar"
			   	aria-label="Close">
			</button>
		</div>
		<div class="offcanvas-body p-md-3 w-100">
			<nav>
				<ul class="nav flex-column w-100">
					<li class="nav-item">
						<a href="https://openwebwork.github.io/pg-docs/pod" class="nav-link p-0">WeBWorK POD Home</a>
					</li>
					<li class="nav-item">
						<a href="http://webwork.maa.org/wiki/WeBWorK_Main_Page" class="nav-link p-0">WeBWorK Wiki</a>
					</li>
					<li><hr></li>
<li class="nav-item"><a class="nav-link p-0" href="#NAME">NAME</a></li><li class="nav-item"><a class="nav-link p-0" href="#DESCRIPTION">DESCRIPTION</a>
    <ul class="nav flex-column w-100">
      <li class="nav-item"><a class="nav-link p-0" href="#Answer-blank-macros">Answer blank macros:</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#answer_matrix">answer_matrix</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Hints-solutions-and-statement-macros">Hints, solutions, and statement macros</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Comments-to-instructors">Comments to instructors</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Pseudo-random-number-generator">Pseudo-random number generator</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Display-Macros">Display Macros</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Display-constants">Display constants</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#SPAN-and-DIV-macros">SPAN and DIV macros</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#TEXT-macros">TEXT macros</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Evaluation-macros">Evaluation macros</a>
        <ul class="nav flex-column w-100">
          <li class="nav-item"><a class="nav-link p-0" href="#EV3">EV3</a></li>
          <li class="nav-item"><a class="nav-link p-0" href="#refreshEquations">refreshEquations</a></li>
          <li class="nav-item"><a class="nav-link p-0" href="#addToTeXPreamble">addToTeXPreamble</a></li>
          <li class="nav-item"><a class="nav-link p-0" href="#FEQ">FEQ</a></li>
          <li class="nav-item"><a class="nav-link p-0" href="#EV2">EV2</a></li>
          <li class="nav-item"><a class="nav-link p-0" href="#EV3P">EV3P</a></li>
        </ul>
      </li>
      <li class="nav-item"><a class="nav-link p-0" href="#Formatting-macros">Formatting macros</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#htmlLink">htmlLink</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#knowlLink">knowlLink</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#helpLink">helpLink</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#PGsort">PGsort</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Sorting-and-other-list-macros">Sorting and other list macros</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Macros-for-handling-tables">Macros for handling tables</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Macros-for-displaying-images">Macros for displaying images</a></li>
      <li class="nav-item"><a class="nav-link p-0" href="#Tag-helper-method">Tag helper method:</a></li>
    </ul>
  </li>				</ul>
			</nav>
		</div>
	</aside>
	<div class="pod-page-container d-flex">
		<div class="container-fluid p-3 h-100" id="_podtop_">


<a href="#_podtop_"><h1 id="NAME">NAME</h1></a>

<p>PGbasicmacros.pl - A set of basic functions and constants for PG problems.</p>

<a href="#_podtop_"><h1 id="DESCRIPTION">DESCRIPTION</h1></a>

<p>This includes constants and basic functions for PG.</p>

<h2 id="Answer-blank-macros">Answer blank macros:</h2>

<p>These produce answer blanks of various sizes or pop up lists or radio answer buttons. The names for the answer blanks are generated and implicitly associated with answer evaluators via the <code>ANS</code> method.</p>

<pre><code>ans_rule(width)
ans_radio_buttons(value1 =&gt; name1, value2, name2 =&gt; value3, name3 =&gt; ...)
pop_up_list(@list)      # list consists of (value =&gt; label, PR =&gt; &quot;Product rule&quot;, ...)
pop_up_list([@list])    # list consists of values</code></pre>

<p>In the last case, one can use <code>pop_up_list([&#39;?&#39;, &#39;yes&#39;, &#39;no&#39;])</code> to produce a pop-up list containing the three strings listed, and then use str_cmp to check the answer.</p>

<p>To indicate the checked position of radio buttons put a &#39;%&#39; in front of the value: <code>ans_radio_buttons(1, &#39;Yes&#39;, &#39;%2&#39;, &#39;No&#39;)</code> will have &#39;No&#39; checked.</p>

<p>The following method is defined in <i>PG.pl</i> for entering the answer evaluators corresponding to answer rules with automatically generated names. The answer evaluators are matched with the answer rules in the order in which they appear on the page.</p>

<pre><code>ANS(ans_evaluator1, ans_evaluator2, ...);</code></pre>

<p>These are more primitive macros which produce answer blanks for specialized cases when complete control over the matching of answers blanks and answer evaluators is desired. The names of the answer blanks must be generated manually, and it is best if they do NOT begin with the default answer prefix (currently AnSwEr).</p>

<pre><code>NAMED_ANS_RULE(name, width)
labeled_ans_rule(name, width)    # alias for NAMED_ANS_RULE
    NAMED_ANS_BOX(name, rows, cols)
NAMED_ANS_RADIO(name, value, name)
NAMED_ANS_RADIO_EXTENSION(name, value, name)
NAMED_ANS_RADIO_BUTTONS(name, value1, name1, value2, name2, ...)
NAMED_POP_UP_LIST($name, @list)     # list consists of (value =&gt; tag, PR =&gt; &quot;Product rule&quot;, ...)
NAMED_POP_UP_LIST($name, [@list])   # list consists of a list of values
                                    # (and each tag will be set to the corresponding value)</code></pre>

<p>(Name is the name of the input, value is the value given to the input when this option is selected, and label is the text printed next to the button or check box. Check box variables can have multiple values.)</p>

<p>NAMED_ANS_RADIO_BUTTONS creates a sequence of NAMED_ANS_RADIO and NAMED_ANS_RADIO_EXTENSION items which are output either as an array or, in scalar context, as the array glued together with spaces. It is usually easier to use this than to manually construct the radio buttons by hand. However, sometimes extra flexibility is desiredin which case:</p>

<p>When entering radio buttons using the &quot;NAMED&quot; format, you should use NAMED_ANS_RADIO button for the first button and then use NAMED_ANS_RADIO_EXTENSION for the remaining buttons. NAMED_ANS_RADIO requires a matching answer evalutor, while NAMED_ANS_RADIO_EXTENSION does not. The name used for NAMED_ANS_RADIO_EXTENSION should match the name used for NAMED_ANS_RADIO (and the associated answer evaluator).</p>

<p>The following method is defined for entering the answer evaluators corresponding to answer rules. The answer evaluators are matched with the answer rules in the order in which they appear on the page.</p>

<pre><code>NAMED_ANS(name1 =&gt; ans_evaluator1, name2 =&gt; ans_evaluator2, ...);</code></pre>

<p>Auxiliary macros defined in PG.pl:</p>

<dl>

<dt>NEW_ANS_NAME()</dt>
<dd>

<p>Produces a new anonymous answer blank name by appending a number to the prefix (AnSwEr).</p>

</dd>
<dt>ANS_NUM_TO_NAME(number)</dt>
<dd>

<p>Prepends the prefix (AnSwEr) to the number, but does nothing else.</p>

</dd>
<dt>RECORD_ANS_NAME(name)</dt>
<dd>

<p>Records the order in which the answer blank is rendered. All answer rules must be recorded by this method. All named answer rule methods in this macro do this. Most answer rules created elsewhere call a named answer rule method in this macro to handle this.</p>

</dd>
<dt>RECORD_IMPLICIT_ANS_NAME(name)</dt>
<dd>

<p>Records answer names which are to be implicitly associated with an answer This is called by the internal answer rule methods, but must be called for all answer rules constructed elsewhere as well. After this is called <code>RECORD_ANS_NAME</code> must be called as well. Usually the appropriate named answer rule method should be called which will do this.</p>

</dd>
</dl>

<p>Deprecated macro (still used by many problems):</p>

<pre><code>ANS_RULE(number, width);    # equivalent to ans_rule(width) -- number is ignored</code></pre>

<h2 id="answer_matrix">answer_matrix</h2>

<p>Usage:</p>

<pre><code>\[ \{ answer_matrix(rows, columns, width_of_ans_rule, @options) \} \]</code></pre>

<p>Creates an array of answer blanks and passes it to display_matrix which returns text which represents the matrix in TeX format used in math display mode. Answers are then passed back to whatever answer evaluators you write at the end of the problem. (note, if you have an m x n matrix, you will need mn answer evaluators, and they will be returned to the evaluaters starting in the top left hand corner and proceed to the left and then at the end moving down one row, just as you would read them.)</p>

<p>The options are passed on to display_matrix.</p>

<p>Note (7/21/2017) The above usage does not work. Omitting the \[ \] works, but also must load PGmatrixmacros.pl to get display_matrix used below</p>

<h2 id="Hints-solutions-and-statement-macros">Hints, solutions, and statement macros</h2>

<pre><code>solution(&#39;text&#39;, &#39;text2&#39;, ...);
SOLUTION(&#39;text&#39;, &#39;text2&#39;, ...); # equivalent to TEXT(solution(...));

hint(&#39;text&#39;, &#39;text2&#39;, ...);
HINT(&#39;text&#39;, &#39;text2&#39;, ...);    # equivalent to TEXT(&quot;$BR$HINT&quot; . hint(@_) . &quot;$BR&quot;) if hint(@_);

statement(&#39;text&#39;);
STATEMENT(&#39;text&#39;);            # equivalent to TEXT(statement(...));</code></pre>

<p>statement takes a string, probably from EV3P, and possibly wraps opening and closing content, paralleling one feature of solution and hint.</p>

<p>If $envir{showSolutions} is set to 1 then the solution is displayed.</p>

<p>If $envir{showHints} is set to 1 then the hint is displayed.</p>

<h2 id="Comments-to-instructors">Comments to instructors</h2>

<pre><code>COMMENT(&#39;text&#39;, &#39;text2&#39;, ...);</code></pre>

<p>Takes the text to be lines of a comment to be shown only in the Library Browser below the rendered problem.</p>

<p>The function COMMENT stores the needed html in the variable pgComment, which gets transfered to the flag &#39;comment&#39; in PG_FLAGS.</p>

<h2 id="Pseudo-random-number-generator">Pseudo-random number generator</h2>

<p>Usage:</p>

<pre><code>random(0, 5, .1)          # produces a random number between 0 and 5 in increments of .1
non_zero_random(0, 5, .1) # gives a non-zero random number

list_random(2, 3, 5, 6, 7, 8, 10) # produces random value from the list
list_random(2, 3, (5..8), 10) # does the same thing

SRAND(seed)     # resets the main random generator -- use very cautiously</code></pre>

<p>SRAND(time) will create a different problem everytime it is called. This makes it difficult to check the answers :-).</p>

<p>SRAND($envir-&gt;{&#39;inputs_ref&#39;}-&gt;{&#39;key&#39;} ) will create a different problem for each login session. This is probably what is desired.</p>

<h2 id="Display-Macros">Display Macros</h2>

<p>These macros produce different output depending on the display mode being used to show the problem on the screen, or whether the problem is being converted to TeX to produce a hard copy output.</p>

<pre><code>MODES   ( TeX        =&gt; &quot;Output this in TeX mode&quot;,
          HTML       =&gt; &quot;output this in HTML mode&quot;,
          HTML_tth   =&gt; &quot;output this in HTML_tth mode&quot;,
          HTML_dpng  =&gt; &quot;output this in HTML_dpng mode&quot;,
         )

M3      (tex_version, latex2html_version, html_version) #obsolete
        Note the LaTeX2HTML version remains for backward compatibility.</code></pre>

<h2 id="Display-constants">Display constants</h2>

<pre><code>@ALPHABET           ALPHABET()           capital letter alphabet -- ALPHABET[0] = &#39;A&#39;
$PAR                PAR()                paragraph character (\par or &lt;p&gt;)
$BR                 BR()                 line break character
$BRBR               BRBR()               line break character
$LQ                 LQ()                 left double quote
$RQ                 RQ()                 right double quote
$BM                 BM()                 begin math
$EM                 EM()                 end math
$BDM                BDM()                begin display math
$EDM                EDM()                end display math
$LTS                LTS()                strictly less than
$GTS                GTS()                strictly greater than
$LTE                LTE()                less than or equal
$GTE                GTE()                greater than or equal
$BEGIN_ONE_COLUMN   BEGIN_ONE_COLUMN()   begin one-column mode
$END_ONE_COLUMN     END_ONE_COLUMN()     end one-column mode
$SOL                SOLUTION_HEADING()   solution headline
$SOLUTION           SOLUTION_HEADING()   solution headline
$HINT               HINT_HEADING()       hint headline
$US                 US()                 underscore character
$SPACE              SPACE()              space character (tex and latex only)
$NBSP               NBSP()               non breaking space character
$NDASH              NDASH()              en dash character
$MDASH              MDASH()              em dash character
$BLABEL             BLABEL()             begin label (for input)
$ELABEL             ELABEL()             end label (for input)
$BBOLD              BBOLD()              begin bold typeface
$EBOLD              EBOLD()              end bold typeface
$BITALIC            BITALIC()            begin italic typeface
$EITALIC            EITALIC()            end italic typeface
$BUL                BUL()                begin underlined type
$EUL                EUL()                end underlined type
$BCENTER            BCENTER()            begin centered environment
$ECENTER            ECENTER()            end centered environment
$BLTR               BLTR()               begin left to right environment
$ELTR               ELTR()               end left to right environment
$BKBD               BKBD()               begin &quot;keyboard&quot; input text
$EKBD               EKBD()               end &quot;keyboard&quot; input text
$HR                 HR()                 horizontal rule
$LBRACE             LBRACE()             left brace
$LB                 LB ()                left brace
$RBRACE             RBRACE()             right brace
$RB                 RB ()                right brace
$DOLLAR             DOLLAR()             a dollar sign
$PERCENT            PERCENT()            a percent sign
$CARET              CARET()              a caret sign
$PI                 PI()                 the number pi
$E                  E()                  the number e
$LATEX              LATEX()              the LaTeX logo
$TEX                TEX()                the TeX logo
$APOS               APOS()               an apostrophe</code></pre>

<h2 id="SPAN-and-DIV-macros">SPAN and DIV macros</h2>

<p>These are functions primarly meant to add HTML block level DIV or inline SPAN tags and the relevant closing tags for HTML output.</p>

<p>At present, these macros require the user to provide TeX and preTeXt strings which will be used in those modes instead of the HTML block level DIV or inline SPAN tag.</p>

<p>If they are missing, they will default to the empty string. If only one string is given, it will be assumed to be the TeX string.</p>

<p>At present only the following 4 HTML attributes can be set: lang, dir, class, style. Using the style option requires creating valid CSS text. For safety some parsing/cleanup is done and various sorts of (apparently) invalid values may be dropped. See the code for details of what input sanitation is done.</p>

<p>Since the use of style is particularly dangerous, in order to enable its use you must set allowStyle to 1 in the hash. It is possible to prevent the use of some of the other options by setting certain control like allowLang to 0.</p>

<p>Usage:</p>

<pre><code>openSpan( options_hash,  &quot;tex code&quot;, &quot;ptx code&quot; );
closeSpan(&quot;tex code&quot;, &quot;ptx code&quot;);</code></pre>

<p>Usage where TeX and PTX output will be empty by default:</p>

<pre><code>openSpan( options_hash );
closeSpan();</code></pre>

<p>Sample options hashes</p>

<pre><code>{ &quot;lang&quot; =&gt; &quot;he&quot;,
  &quot;dir&quot; =&gt; &quot;rtl&quot;,
  &quot;class&quot; =&gt; &quot;largeText class123&quot; }

{ &quot;lang&quot; =&gt; &quot;he&quot;,
  &quot;allowStyle&quot; =&gt; 1,
   &quot;style&quot; =&gt; &quot;background-color: \&quot;#afafaf; float: left;\t height: 12px;&quot; }</code></pre>

<h2 id="TEXT-macros">TEXT macros</h2>

<p>Usage:</p>

<pre><code>TEXT(@text);</code></pre>

<p>This is the simplest way to print text from a problem. The strings in the array <code>@text</code> are concatenated with spaces between them and printed out in the text of the problem. The text is not processed in any other way. <code>TEXT</code> is defined in PG.pl.</p>

<p>Usage:</p>

<pre><code>BEGIN_TEXT
    text.....
END_TEXT</code></pre>

<p>This is the most common way to enter text into the problem. All of the text between BEGIN_TEXT and END_TEXT is processed by the <code>EV3</code> macro described below and then printed using the <code>TEXT</code> command. The two key words must appear on lines by themselves. The preprocessing that makes this construction work is done in <i>PGtranslator.pm</i>. See <code>EV3</code> below for details on the processing.</p>

<h2 id="Evaluation-macros">Evaluation macros</h2>

<h3 id="EV3">EV3</h3>

<pre><code>TEXT(EV3(&quot;This is a formulat \( \int_0^5 x^2 \, dx \) &quot;);
TEXT(EV3(@text));

TEXT(EV3(&lt;&lt;&#39;END_TEXT&#39;));
    text stuff...
END_TEXT</code></pre>

<p>The BEGIN_TEXT/END_TEXT construction is translated into the construction above by PGtranslator.pm. END_TEXT must appear on a line by itself and be left justified. (The &lt;&lt; construction is known as a &quot;here document&quot; in UNIX and in PERL.)</p>

<p>The single quotes around END_TEXT mean that no automatic interpolation of variables takes place in the text. Using EV3 with strings which have been evaluated by double quotes may lead to unexpected results.</p>

<p>The evaluation macro E3 first evaluates perl code inside the braces: <code>\{ code \}</code>. Any perl statment can be put inside the braces. The result of the evaluation (i.e. the last statement evaluated) replaces the <code>\{ code \}</code> construction.</p>

<p>Next interpolation of all variables (e.g. <code>$var or @array</code> ) is performed.</p>

<p>Then mathematical formulas in TeX are evaluated within the <code>\( tex math mode \)</code> and <code>\[ tex display math mode \] </code> constructions, in that order:</p>

<h3 id="refreshEquations">refreshEquations</h3>

<pre><code>refreshEquations(1);</code></pre>

<p>Prevents equations generated in &quot;image mode&quot; from being cached. This can be useful for debugging. It has no effect in the other modes.</p>

<h3 id="addToTeXPreamble">addToTeXPreamble</h3>

<pre><code>addToTeXPreamble(&quot;\newcommand{\myVec}[1]{\vec{#1}} &quot;);</code></pre>

<p>Defines <code>\myVec </code> for all the equations in the file. You can change the vector notation for an entire PG question by changing just this line.</p>

<p>If you place this macro in PGcourse.pl remember to use double backslashes because it is a .pl file. In .pg files use single backslashes. This is in accordance with the usual rules for backslash in PG.</p>

<p>For the moment this change only works in image mode. It does not work in MathJax mode. Stay tuned.</p>

<p>Adding this command</p>

<pre><code>\newcommand{\myVec}[1]{\vec{#1}}</code></pre>

<p>to TeX(hardcopy) portion of the setHeaderCombinedFile.pg ( or to the setHeaderHardcopyFile.pg for each homework set will take care of the TeX hardcopy version</p>

<p>You can also modify the TexPreamble file in webwork2/conf/snippets to set the definition of \myVec for hardcopy for the entire site.</p>

<p>There are ways you can use course.conf to allow course by course modification by choosing different TeXPreamble files for different courses</p>

<h3 id="FEQ">FEQ</h3>

<pre><code>FEQ($string);   # processes and outputs the string</code></pre>

<p>The mathematical formulas are run through the macro <code>FEQ</code> (Format EQuations) which performs several substitutions (see below). In <code>HTML_tth</code> mode the resulting code is processed by tth to obtain an HTML version of the formula.</p>

<p>The resulting string is output (and usually fed into TEXT to be printed in the problem).</p>

<p>Usage:</p>

<pre><code>$string2 = FEQ($string1);</code></pre>

<p>This is a filter which is used to format equations by <code>EV2</code> and <code>EV3</code>, but can also be used on its own. It is best understood with an example.</p>

<pre><code>$string1 = &quot;${a}x^2 + ${b}x + {$c:%.1f}&quot;; $a = 3;, $b = -2; $c = -7.345;</code></pre>

<p>when interpolated becomes:</p>

<pre><code>$string1 = &#39;3x^2 + -2x + {-7.345:%0.1f}</code></pre>

<p>FEQ first changes the number of decimal places displayed, so that the last term becomes -7.3 Then it removes the extraneous plus and minus signs, so that the final result is what you want:</p>

<pre><code>$string2 = &#39;3x^2 - 2x -7.3&#39;;</code></pre>

<p>(The %0.1f construction is the same formatting convention used by Perl and nearly identical to the one used by the C printf statement. Some common usage: %0.3f 3 decimal places, fixed notation; %0.3e 3 significant figures exponential notation; %0.3g uses either fixed or exponential notation depending on the size of the number.)</p>

<p>Two additional legacy formatting constructions are also supported:</p>

<p><code>!{$c:%0.3f} </code> will give a number with 3 decimal places and a negative sign if the number is negative, no sign if the number is positive. Since this is identical to the behavior of <code>{$c:%0.3f}</code> the use of this syntax is depricated.</p>

<p><code>?{$c:%0.3f}</code> determines the sign and prints it whether the number is positive or negative. You can use this to force an expression such as <code>+5.456</code>.</p>

<h3 id="EV2">EV2</h3>

<pre><code>TEXT(EV2(@text));

TEXT(EV2(&lt;&lt;END_OF_TEXT));
    text stuff...
END_OF_TEXT</code></pre>

<p>This is a precursor to EV3. In this case the constants are interpolated first, before the evaluation of the \{ ...code...\} construct. This can lead to unexpected results. For example <code>\{ join(&quot; &quot;, @text) \}</code> with <code>@text = (&quot;Hello&quot;, &quot;World&quot;);</code> becomes, after interpolation, <code>\{ join(&quot; &quot;, Hello World) \}</code> which then causes an error when evaluated because Hello is a bare word. <code>EV2</code> can still be useful if you allow for this, and in particular it works on double quoted strings, which lead to unexpected results with <code>EV3</code>. Using single quoted strings with <code>EV2</code> may lead to unexpected results.</p>

<p>The unexpected results have to do with the number of times backslashed constructions have to be escaped. It is quite messy. For more details get a good Perl book and then read the code. :-)</p>

<h3 id="EV3P">EV3P</h3>

<pre><code>######################################################################
#
#  New version of EV3 that allows `...` and ``...`` to insert TeX produced
#  by the new Parser (in math and display modes).
#
#  Format:  EV3P(string, ...);
#           EV3P({options}, string, ...);
#
#           `x^2/5` will become \(\frac{x^2}{5}\) and then rendered for hardcopy or screen output
#
#  where options can include:
#
#    processCommands =&gt; 0 or 1     Indicates if the student&#39;s answer will
#                                  be allowed to process \{...\}.
#                                    Default: 1
#
#    processVariables =&gt; 0 1       Indicates whether variable substitution
#                                  should be performed on the student&#39;s
#                                  answer.
#                                    Default: 1
#
#    processMath =&gt; 0 or 1         Indicates whether \(...\), \[...\],
#                                  `...` and ``...`` will be processed
#                                  in the student&#39;s answer.
#                                    Default: 1
#
#    processParser =&gt; 0 or 1       Indicates if `...` and ``...`` should
#                                  be processed when math is being
#                                  processed.
#                                    Default: 1
#
#    fixDollars =&gt; 0 or 1          Specifies whether dollar signs not followed
#                                  by a letter should be replaced by ${DOLLAR}
#                                  prior to variable substitution (to prevent
#                                  accidental substitution of strange Perl
#                                  values).
#                                    Default: 1
#</code></pre>

<h2 id="Formatting-macros">Formatting macros</h2>

<pre><code>beginproblem()  # Adds a custom TeX preamble.  This is deprecated and should not be used in newly written problems.
OL(@array)      # formats the array as an Ordered List ( &lt;OL&gt; &lt;/OL&gt; ) enumerated by letters.
                # See BeginList()  and EndList in unionLists.pl for a more powerful version
                # of this macro.
knowlLink($display_text, url =&gt; $url, value =&gt;&#39;&#39;, type =&gt;&#39;&#39; )
                # Places a reference to a knowl for the URL with the specified text in the problem.
                # A common usage is \{ &#39;for help&#39;, url =&gt;knowlLink(alias(&#39;prob1_help.html&#39;)) \} )
                # where alias finds the full address of the prob1_help.html file in the same directory
                # as the problem file
knowlLink($display_text,  url =&gt; &#39;&#39;, type =&gt;&#39;&#39;, value = &lt;&lt;EOF );  # this starts a here document that ends at EOF (left justified)
                help text goes here .....
EOF
                # This version of the knowl reference facilitates immediate reference to a HERE document
                # The function should be called either with value specified (immediate reference) or
                # with url specified in which case the revealed text is taken from the URL $url.
                # The $display_text is always visible and is clicked to see the contents of the knowl.
iframe($url, height=&gt;&#39;&#39;, width=&gt;&#39;&#39;, id=&gt;&#39;&#39;, name=&gt;&#39;&#39; )
                # insert the web page referenced by $url in a space defined by height and width
                # if the webpage contains a form then this must be inserted between
                # BEGIN_POST_HEADER_TEXT/END_POST_HEADER_TEXT  to avoid having one
                # form(from the webpage) inside another (the defining form for the problem
A wide variety of google widgets, youtube videos, and other online resources can be imbedded using this macro. In HTML mode it creates an iframe, in TeX mode it prints the url.

helpLink($type)
               Allows site specific help.
               The parameter localHelpURL  must be defined in the environment
               and is set by default to pg/htdocs/helpFiles
               Standard helpFile types
                    &#39;angle&#39;
                    &#39;decimal&#39;
                    &#39;equation&#39;
                    &#39;essay&#39;
                    &#39;exponent&#39;
                    &#39;formula&#39;
                    &#39;fraction&#39;
                    &#39;inequalit&#39;
                    &#39;limit&#39;
                    &#39;log&#39;
                    &#39;number&#39;
                    &#39;point&#39;
                    &#39;vector&#39;
                    &#39;interval&#39;
                    &#39;unit&#39;
                    &#39;syntax&#39;

low level:

spf($number, $format)   # prints the number with the given format
sspf($number, $format)  # prints the number with the given format, always including a sign.
nicestring($coefficients, $terms) # print a linear combinations of terms using coefficients
nicestring($coefficients) # uses the coefficients to make a polynomial
        # For example
        # nicestring([1, -2, 0]) produces &#39;x^2-2x&#39;
        # nicestring([2, 0, -1], [&#39;&#39;, &#39;t&#39;, &#39;t^2&#39;]) produces &#39;2-t^2&#39;
protect_underbar($string) # protects the underbar (class_name) in strings which may have to pass through TeX.</code></pre>

<h2 id="htmlLink">htmlLink</h2>

<p>Usage:</p>

<pre><code>htmlLink($url, $text, @attributes)</code></pre>

<p>Places an HTML link to <code>$url</code> with the specified <code>$text</code> in the problem. The <code>@attributes</code> are optional. They should be provided as attribute/value pairs, but a single text string argument can be given (although calling <code>htmlLink</code> in that way is deprecated and should not be done in new problems). For example,</p>

<pre><code>BEGIN_PGML
Download the [@ htmlLink($url, &#39;dataset&#39;, download =&gt; &#39;dataset.csv&#39;) @]*
for this problem.</code></pre>

<h2 id="knowlLink">knowlLink</h2>

<p>Inserts a knowl link into the problem. Usually you should not call this method directly. Instead use <code>helpLink</code> below.</p>

<p>Usage:</p>

<pre><code>knowlLink($displayText, %options)</code></pre>

<p><code>$display_text</code> is the text that will be shown for the link.</p>

<p>The following options may be included in <code>%options</code>. Note that one of <code>url</code> or <code>value</code> is required.</p>

<dl>

<dt>url</dt>
<dd>

<p>A URL whose contents will be shown in a modal dialog when the knowl link is clicked. These contents will be fetched by JavaScript and injected into the knowl modal dialog.</p>

</dd>
<dt>value</dt>
<dd>

<p>The direct contents that will be shown in a modal dialog when the knowl link is clicked.</p>

</dd>
<dt>title</dt>
<dd>

<p>A string that will be used for the title of the modal dialog that opens when the knowl link is clicked. If this is not provided, then <code>$display_text</code> will be used for the title.</p>

</dd>
<dt>type</dt>
<dd>

<p>A string that will be set as the data-type attribute of the knowl link. This is only used by PreTeXt.</p>

</dd>
</dl>

<p>Example usage:</p>

<pre><code>knowlLink(&#39;Click Me&#39;, title =&gt; &#39;Fascinating Contents&#39;, value =&gt; &#39;Here are my facinating contents.&#39;);
knowlLink(&#39;Help Me&#39;, title =&gt; &#39;Help Contents&#39;, url =&gt; &#39;https://my.domain.edu/helpfile-contents&#39;);</code></pre>

<h2 id="helpLink">helpLink</h2>

<p>Usage:</p>

<pre><code>helpLink($type, $display_text, $helpurl)</code></pre>

<p>Creates links for students to help documentation on formatting answers and allows for custom help links.</p>

<p>There are 16 predefined help links: angles, decimals, equations, exponents, formulas, fractions, inequalities, intervals, limits, logarithms, matrices, numbers, points, syntax, units, vectors.</p>

<p>Usage:</p>

<pre><code>DOCUMENT();
loadMacros(&quot;PGstandard.pl&quot;);
BEGIN_TEXT
\{ ans_rule(20) \} \{ helpLink(&quot;formulas&quot;) \}
$PAR
\{ ans_rule(20) \} \{ helpLink(&quot;equations&quot;, &quot;help entering equations&quot;) \}
$PAR
\{ ans_rule(20) \}
\{ helpLink(&quot;my custom help&quot;, undef, &quot;custom_help.html&quot;) \}
END_TEXT
ENDDOCUMENT();</code></pre>

<p>The first example uses the default link text and displays the help link next to the answer blank which is recommended.</p>

<p>The second example customizes the link text displayed to the student, but the actual help document is unaffected.</p>

<p>The third example displays a link to the contents of <code>custom_help.html</code>. Note that the file <code>custom_help.html</code> must be located in the location defined in the environment variable <code>$envir{localHelpURL}</code>. The value of that variable can be customized by a problem.</p>

<h2 id="PGsort">PGsort</h2>

<p>Because of the way sort is optimized in Perl, the symbols $a and $b have special significance.</p>

<pre><code>sort {$a&lt;=&gt;$b} @list
sort {$a cmp $b} @list</code></pre>

<p>sorts the list numerically and lexically respectively.</p>

<p>If <code>my $a;</code> is used in a problem, before the sort routine is defined in a macro, then things get badly confused. To correct this the macro PGsort is defined below. It is evaluated before the problem template is read. In PGbasicmacros.pl, the two subroutines</p>

<pre><code>PGsort sub { $_[0] &lt; $_[1] }, @list;
PGsort sub { $_[0] lt $_[1] }, @list;</code></pre>

<p>(called num_sort and lex_sort) provide slightly slower, but safer, routines for the PG language. (The subroutines for ordering are <b>required</b>. Note the commas!)</p>

<h2 id="Sorting-and-other-list-macros">Sorting and other list macros</h2>

<p>Usage:</p>

<pre><code>lex_sort(@list);   # outputs list in lexigraphic (alphabetical) order
num_sort(@list);   # outputs list in numerical order
uniq( @list);      # outputs a list with no duplicates.  Order is unspecified.

PGsort( \&amp;sort_subroutine, @list);
# &amp;sort_subroutine defines order. It&#39;s output must be 1 or 0 (true or false)</code></pre>

<h2 id="Macros-for-handling-tables">Macros for handling tables</h2>

<p><b>Note: that these are deprecated. See <a href="https://metacpan.org/pod/nicetables.pl">nicetables.pl</a> for a replacement.</b></p>

<p>Usage:</p>

<pre><code>begintable( number_of_columns_in_table)
row(@dataelements)
endtable()</code></pre>

<p>Example of useage:</p>

<pre><code>BEGIN_TEXT
    This problem tests calculating new functions from old ones:$BR
    From the table below calculate the quantities asked for:$BR
    \{begintable(scalar(@firstrow)+1)\}
    \{row(&quot; \(x\) &quot;, @firstrow)\}
    \{row(&quot; \(f(x)\) &quot;, @secondrow)\}
    \{row(&quot; \(g(x)\) &quot;, @thirdrow)\}
    \{row(&quot; \(f&#39;(x)\) &quot;, @fourthrow)\}
    \{row(&quot; \(g&#39;(x)\) &quot;, @fifthrow)\}
    \{endtable()\}

 (The arrays contain numbers which are placed in the table.)

END_TEXT</code></pre>

<h2 id="Macros-for-displaying-images">Macros for displaying images</h2>

<p>Usage:</p>

<pre><code>image($image, width =&gt; ..., height =&gt; ..., tex_size =&gt; ..., valign =&gt; ..., alt =&gt; ..., long_description =&gt; ... );</code></pre>

<p>where <code>$image</code> can be a local file path, URL, WWPlot object, PGlateximage object, PGtikz object, Plots::Plot object, or parser::GraphTool object.</p>

<p><code>width</code> and <code>height</code> are positive integer pixel counts for HTML display. If both are missing, <code>width</code> will default to 200 and <code>height</code> will remain undeclared, letting the browser display the image with its natural aspect ratio. Except with a parser::GraphTool object, if both are missing then nothing will be passed along to the GraphTool method for display, and that macro&#39;s defaults will be used.</p>

<p><code>tex_size</code> is also a positive integer, per 1000 applied to the line width in TeX. For example 800 leads to 0.8\linewidth. If over 1000, then 1000 will be used. If missing, this defaults to <code>int(width/0.6)</code> so the image is proportional to its HTML version with a 600 pixel wide reading area. If <code>width</code> is missing and <code>height</code> is declared, we presume this is a wide image and then <code>tex_size</code> defaults to 800.</p>

<p><code>valign</code> can be &#39;top&#39;, &#39;middle&#39;, or &#39;bottom&#39;. This aligns the image relative to the surrounding line of text.</p>

<p><code>alt</code> should be a string, ideally with fewer than 125 characters, that describes the most important features of the image. This should always be used. If the image is decorative, <code>alt =&gt; &#39;&#39;</code> should be used.</p>

<p><code>long_description</code> provides an optional way to give a more complete description of an image. This may include a table (for example to describe complex data in a graph). It may be helpful to generate blocks of text and tables and store them in a variable, and pass that variable to <code>long_description</code>.</p>

<p><code>long_description_width</code> defaults to 1. This should be a positive number at most 1. In hardcopy output, this portion of the line width will be used to cap the width of the long description (if there is one). This is useful for example when the image is inside a table.</p>

<p><code>extra_html_tags</code> [DEPRECATED] can be a string will directly be placed into the HTML img element. For example, <code>extra_html_tags =&gt; &#39;style=&quot;border:solid black 1pt&quot;&#39;</code>.</p>

<p>The first argument to <code>image()</code> can alternatively be an array of images:</p>

<pre><code>image([$image1, $image2], ...);</code></pre>

<p>If so then if <code>alt</code> or <code>long_description</code> are not arrays, they will be used repeatedly for each image. Each of <code>alt</code> and <code>long_description</code> can instead be arrays of the same length and their entries will be used with the corresponding image.</p>

<p>In array context, using <code>image()</code> this way will produces an array in array context and join the elements with <code>&#39; &#39;</code> in scalar context.</p>

<h2 id="Tag-helper-method">Tag helper method:</h2>

<pre><code>tag(&#39;input&#39;, name =&gt; &#39;AnSwEr0001&#39;, id =&gt; &#39;answer_id&#39;)
tag(&#39;div&#39;, class =&gt; &#39;style-class&#39;, &#39;This is my content&#39;)</code></pre>

<p>This produces an html tag with attributes. This is designed to be similar to the Mojolicious::Plugin::TagHelpers tag method (although much simpler and not nearly as versatile). The first argument is the tag name and is required. This is followed by attribute <code>name =&gt; value</code> pairs. Note that all underscores in attribute names are converted into hyphens. The final argument is the content of the tag. If not given the tag will have no content. This is ignored for a self closing tag if given.</p>

<p>Currently this is only designed to be used for HTML output, but perhaps could be extended for XML (PTX) output.</p>

		</div>
	</div>
</body>
</html>
